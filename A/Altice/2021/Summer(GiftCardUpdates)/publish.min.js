var fs=require("fs"),path=require("path"),AdmZip=require("adm-zip"),masterPath=__dirname+"/",folderPath=__dirname+"/publish/",removeFiles=function(c){try{fs.readdirSync(c).forEach(function(a){var b=fs.statSync(c+a);b.isFile()&&fs.unlinkSync(c+a);b.isDirectory()&&removeFiles(c+a+"/")}),folderPath!=c&&fs.rmdirSync(c)}catch(a){console.log(a)}};fs.existsSync(folderPath)?removeFiles(folderPath):fs.mkdirSync(folderPath);var frames={},adsLocation=masterPath+"ads/",files=fs.readdirSync(adsLocation);
files.forEach(function(c){if(fs.statSync(adsLocation+c).isDirectory()){var a=adsLocation+c+"/";fs.readdirSync(a).forEach(function(b){if(fs.statSync(a+b).isDirectory()){var e=a+b+"/";fs.readdirSync(e).forEach(function(a){fs.statSync(e+a);if(-1!=a.indexOf(b+".html")){var h="ads/"+c+"/"+b+"/",k=h+a;fs.readFile(e+a,"utf8",function(c,b){var g={};if(-1!=b.indexOf('amo.registerAttribute("frameText1"')||-1!=b.indexOf('amo.registerAttribute("frameText11"')||-1!=b.indexOf('amo.registerAttribute("frameImage1"')){g.frame1=
h+a.split(".").join("_frame1.");var f;f=b.replace("gsap.delayedCall(.8, animateFrame1);","gsap.delayedCall(.8, animateFrame1, [true]);");fs.writeFile(g.frame1,f,"utf8",function(a){if(a)throw a;});e++}for(var e=1,d=2;6>=d;d++)-1!=b.indexOf('amo.registerAttribute("frameText'+d+'1"')&&e++;for(d=2;d<=e;d++)-1!=b.indexOf('amo.registerAttribute("frameText'+d+'1"')&&(g["frame"+d]=h+a.split(".").join("_frame"+d+"."),f=b,f=f.replace("gsap.delayedCall(.8, animateFrame1);","if('frame1' in ad.layers) ad.layers.frame1.remove();\n                    gsap.delayedCall(1.2, animateFrame"+
d+", [true]);"),fs.writeFile(g["frame"+d],f,"utf8",function(a){if(a)throw a;}));frames[k]=g;fs.writeFile(masterPath+"frames.js","var publishVersion = "+(new Date).getTime()+", frames="+JSON.stringify(frames),"utf8",function(a){if(a)throw a;})})}})}})}});
